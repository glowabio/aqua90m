<!--#https://www.geeksforgeeks.org/using-leaflet-js-to-show-maps-in-a-webpage/-->

<!-- TODO: -->
<!-- Reclick on a marker, need to change behaviour...  -->
<!-- Add download data as xyz button -->
<!-- Always show stream segment and its strahler? -->
<!-- Polygons: Show strahler order as colour! -->
<!-- Add login, more subcatchments?? -->

<!DOCTYPE html>
<html>

<head>
  <title>Connectivity Tool</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Get the leaflet CSS file -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
integrity=
"sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin="" />
  <link rel="stylesheet" href="mystyle.css"/ >
  <!--script type="text/javascript" src="functions_ogc_requests_sync.js"></script-->
  <script type="text/javascript" src="functions_ogc_requests_async.js"></script>
  <script type="text/javascript" src="functions_ogc_preparation.js"></script>
  <script type="text/javascript" src="functions_styling.js"></script>
  <script type="text/javascript" src="functions_example_buttons.js"></script>
  <script type="text/javascript" src="functions_events.js"></script>
  <script type="text/javascript" src="functions_buttonclick.js"></script>
  <script type="text/javascript" src="functions_clickmarker.js"></script>
  <script type="text/javascript" src="functions_download.js"></script>
</head>

<body>
<div id="container">
  <div id="header">
    <a href="https://aquainfra.eu"><img src="logo_aquainfra.svg" height="35px" /></a>
  </div>

  <div id="body">
  <!--h1>TEMPORARILY OFFLINE: Connectivity Tool</h1-->
  <h1>Connectivity Tool</h1>
  <h3>On-the-fly upstream catchments</h3>


  <!-- Selection -->
  <p><span>Click on the map to display (please choose):</span></p>
  <select id="processes">
    <optgroup label="upstream">
      <option data-pairs="one" value="get-upstream-bbox">Upstream bounding box</option>
      <option data-pairs="one" value="get-upstream-dissolved-cont">Upstream catchment (one large polygon)</option>
      <option data-pairs="one" value="get-upstream-subcatchments">Upstream catchment (individual polygons)</option>
      <option data-pairs="one" value="get-upstream-streamsegments" selected="selected">Upstream stream segments</option>
    </optgroup>
    <optgroup label="local">
      <option data-pairs="one" value="get-local-streamsegments">Local stream segment</option>
      <option data-pairs="one" value="get-local-streamsegments-subcatchments">Local stream segment and local subcatchment</option>
      <option data-pairs="one" value="get-snapped-points">Snapped point</option>
      <option data-pairs="one" value="get-snapped-point-plus">Snapped point, local stream segment and local subcatchment</option>
    </optgroup>
    <optgroup label="routing">
      <option data-pairs="one" value="get-shortest-path-to-outlet">Shortest path from point to sea</option>
      <option data-pairs="two" value="get-shortest-path-between-points">Shortest path from point to point</option>
    </optgroup>
  </select>
  <label><input type="checkbox" id="stylingStrahlerToggle" checked>Style depending on <strong>strahler</strong> order</label>
  <div>
      <input type="text" id="strahlerSnap" class="invisible" value="1"
        onblur="if(this.value==''){ this.value='1'; this.style.color='#BBB';}"
        onfocus="if(this.value==''){ this.value='1'; this.style.color='#000';} else {this.style.color='#000';}"
        style="color:#BBB;" />
  </div>
  <p id="scrollToTop">
    <span class="greynote">Note: Computing may take some time, depending on catchment size!</span>
    <br />
    <span class="greynote">Note: In case you click to a headwater, no upstream catchment is provided, as no upstream exists...</span>
  </p>


  <!-- Map -->
  <div id="map"></div>
  <!-- Behaviour is defined programmatically further below -->
  <p><button id="clearMapButton">Clear the map!</button></p>
  <p><button id="downloadGeojsonButton">Download result as GeoJSON!</button></p>

  <!-- Custom lonlat button -->
  <h3>Input your own coordinates...</h3>
  <table>
    <tr>
    <!-- If you want the grey examples to disappear on focus, set onfocus to this:   onfocus="if(this.value=='9.17'){ this.value='NIX'; this.style.color='#000';}"   -->
      <td>Longitude:</td>
      <td>
        <input type="text" id="customLon1" value="9.0409"
          onblur="if(this.value==''){ this.value='9.0409'; this.style.color='#BBB';}"
          onfocus="if(this.value==''){ this.value='9.0409'; this.style.color='#000';} else {this.style.color='#000';}"
          style="color:#BBB;" />
      </td>
      <td>e.g. <span class="code">9.0409</span></td>
      <td class="fortwo invisible">
        <input type="text" id="customLon2" value="8.99853"
          onblur="if(this.value==''){ this.value='8.99853'; this.style.color='#BBB';}"
          onfocus="if(this.value==''){ this.value='8.99853'; this.style.color='#000';} else {this.style.color='#000';}"
          style="color:#BBB;" />
      </td>
      <td class="fortwo invisible">e.g. <span class="code">9.17</span></td>
    </tr>
    <tr>
      <td>Latitude:</td>
      <td>
        <input type="text" id="customLat1" value="52.7769"
          onblur="if(this.value==''){ this.value='52.7769'; this.style.color='#BBB';}"
          onfocus="if(this.value==''){ this.value='52.7769'; this.style.color='#000';} else {this.style.color='#000';}"
          style="color:#BBB;" />
      </td>
      <td>e.g. <span class="code">52.95</span></td>
      <td class="fortwo invisible">
        <input type="text" id="customLat2" value="52.799"
          onblur="if(this.value==''){ this.value='52.799'; this.style.color='#BBB';}"
          onfocus="if(this.value==''){ this.value='52.799'; this.style.color='#000';} else {this.style.color='#000';}"
          style="color:#BBB;" />
      </td>
      <td class="fortwo invisible">e.g. <span class="code">52.95</span></td>
    </tr>
    <tr>
      <td>Lon lat:</td>
      <td>
        <input type="text" id="customLonLat1" value="9.0409, 52.7769"
          onblur="if(this.value==''){ this.value='9.0409, 52.7769'; this.style.color='#BBB';}"
          onfocus="if(this.value==''){ this.value='9.0409, 52.7769'; this.style.color='#000';} else {this.style.color='#000';}"
          onfocus="{ this.style.color='#000';}"
          style="color:#BBB;" />
      </td>
      <td>e.g. <span class="code">8.99853, 52.799</span></td>
      <td class="fortwo invisible">
        <input type="text" id="customLonLat2" value="8.99853, 52.799"
          onblur="if(this.value==''){ this.value='8.99853, 52.799'; this.style.color='#BBB';}"
          onfocus="if(this.value==''){ this.value='8.99853, 52.799'; this.style.color='#000';} else {this.style.color='#000';}"
          style="color:#BBB;" />
      </td>
      <td class="fortwo invisible">e.g. <span class="code">9.17, 52.95</span></td>
    </tr>
    <tr>
      <td>Subcatchment id:</td>
      <td>
        <input type="text" id="customSubc1" value=""
          onfocus="if(this.value==''){ this.value='507044912'; this.style.color='#000';} else {this.style.color='#000';}"
          style="color:#BBB;" />
      </td>
      <td>e.g. <span class="code">507044912</span></td>
      <td class="fortwo invisible">
        <input type="text" id="customSubc2" value=""
          onfocus="if(this.value==''){ this.value='506924326'; this.style.color='#000';} else {this.style.color='#000';}"
          style="color:#BBB;" />
      </td>
      <td class="fortwo invisible">e.g. <span class="code">506924326</span></td>
    </tr>
  </table>
  <!-- Behaviour is defined programmatically further below -->
  <p><button id="customLonlatButton">Use these values!</button> (The result will be displayed in the map above)</p>


  <!-- Example buttons -->
  <h3>...or use these examples:</h3>
  <p>(The result will be displayed in the map above):</p>
  <table>
    <tr>
      <td><button id="example1" thislon="not set" thislat="not set">not set</button></td>
      <td id="example1desc">(not set)</td>
    </tr>
    <tr>
      <td><button  id="example2" thislon="not set" thislat="not set">not set</button></td>
      <td id="example2desc">(not set)</td>
    </tr>
    <tr>
      <td><button  id="example3" thislon="not set" thislat="not set">not set</button></td>
      <td id="example3desc">(not set)</td>
    </tr>
    <tr>
      <td><button  id="example4" thislon="not set" thislat="not set">not set</button></td>
      <td id="example4desc">(not set)</td>
    </tr>
    <tr>
      <td><button  id="example5" thislon="not set" thislat="not set">not set</button></td>
      <td id="example5desc">(not set)</td>
    </tr>
  </table>


  <!-- Text field for response -->
  <h3>Response returned by server:</h3>
  <p id="responseField">Response returned by server:</p>
  <p><textarea id="displayGeoJSON" class="codeblock" rows="20", cols="120">(Result GeoJSON will be displayed here)</textarea></p>

  <!-- Text field for adding custom GeoJSON -->
  <h3>Enter GeoJSON:</h3>
  <textarea id="customGeoJsonArea" class="codeblock" rows="5" cols="120" placeholder='Paste valid GeoJSON here'></textarea>
  <button id="customGeoJsonButton">Display on map</button>

  <h3>Data sources</h3>
  <p>The data based on which the above functionalities are computed is the <strong>Hydrography90m dataset</strong> (see <a href="https://hydrography.org">hydrography.org</a>), especially the vector layers contained in the <strong>GeoFRESH database</strong> (see <a href="https://geofresh.org">geofresh.org</a>):
  </p>
  <p class="cite">
    Amatulli, G., Garcia Marquez, J.R., Sethi, T., Kiesel, J., Grigoropoulou, A., Üblacker, M., Shen, L., Domisch, S. (2022). Hydrography90m: A new high-resolution global hydrographic dataset. Earth System Science Data, 14, 4525–4550.<br/><a href="https://doi.org/10.5194/essd-14-4525-2022">doi:10.5194/essd-14-4525-2022</a>.
  </p>
  <p class="cite">
    Domisch, S., Bremerich, V., Buurman, M., Kaminke, B., Tomiczek, T., Torres-Cambas, Y., Grigoropoulou, A., Garcia Marquez, J. R., Amatulli, G., Grossart, H. P., Gessner, M. O., Mehner, T., Adrian, R. & De Meester, L. (2024). GeoFRESH – an online platform for freshwater geospatial data processing. International Journal of Digital Earth, 17(1).<br/><a href="https://doi.org/10.1080/17538947.2024.2391033">doi:10.1080/17538947.2024.2391033</a>.
  </p>

  </div> <!-- end of body -->
  <div id="footer">
    <a href="https://www.igb-berlin.de/"><img src="logo_igb.svg" height="35px" /></a>
    <span id="contact"><a id="contact" href="https://glowabio.org/about/">Contact (GLOWABIO working group)</a></span>
  </div>
</div> <!-- end of container -->




  <!-- Get the leaflet JavaScript file -->
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
    integrity=
"sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
    crossorigin=""></script>
  <script>

    // Get URL params, if any:
    const params = new URLSearchParams(window.location.search);
    const paramProcessId = params.get('processId');
    let paramLat   = parseFloat(params.get('lat'));
    let paramLon   = parseFloat(params.get('lon'));
    paramLat = Number.isFinite(paramLat) ? paramLat : null;
    paramLon = Number.isFinite(paramLon) ? paramLon : null;
    console.log("[DEBUG] URL params, values parsed: "+paramLon+", "+paramLat+" (lon, lat), process: "+paramProcessId);

    // Initialize the map
    const map = L.map('map')

    // Collect layers so I can remove them:
    var allMyLayers = [];
    var allMyIcons = [];

    // Get the tile layer from OpenStreetMaps
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, // maximum zoom of map
      attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Set the view of the map
    // with the latitude, longitude and the zoom value
    // either from URL params or default
    //const initialViewLatLon = [paramLat ?? 53.014, paramLon ?? 12.008]; // Northern Germany (zoom 7)
    let initialViewLatLon = [paramLat ?? 60.19123, paramLon ?? 24.94612]; // Helsinki (zoom 10)
    //console.log('[DEBUG] Initial view: ', initialViewLatLon);
    map.setView(initialViewLatLon, 7);

    // Create custom control for process ID
    const infoControl = L.control({ position: "topright" });
    infoControl.onAdd = function (map) {
        this._div = L.DomUtil.create("div", "info-box");
	let processId = document.getElementById("processes").value;
        this._div.innerHTML = "process id: "+processId;
	// Don't move map if user clicks into it to copy-paste
        L.DomEvent.disableClickPropagation(infoControl._div);
        return this._div;
    };
    infoControl.addTo(map);

    // Other way. WORKS!
    //L.geoJSON(data, {
    //    style: function(feature) {
    //        switch (feature.properties.UnitID) {
    //            case 1: return {color: "#ff0000"};
    //            case 2: return {color: "#0000ff"};
    //      default: return {color: "#ff8c00"};
    //        }
    //    }
    //}).addTo(map);



    ///////////////////////////////
    //// Other Event Listeners ////
    ///////////////////////////////

    // Define event listener for adding custom GeoJSON
    // First, define a container for GeoJSON layer
    var geoJsonLayer;
    // Now, define the behaviour:
    var eventCustomGeojsonDisplay = function(evt) {
      try {
        let input = document.getElementById('customGeoJsonArea').value;
        let geojson = JSON.parse(input);

        // Remove existing layer if present
        if (geoJsonLayer) {
          map.removeLayer(geoJsonLayer);
        }

        // Add new GeoJSON layer, zoom to bounds
        geoJsonLayer = L.geoJSON(geojson).addTo(map);

        // Zoom to bounds of new layer, scroll up to map:
        map.fitBounds(geoJsonLayer.getBounds());
        //document.getElementById("map").scrollIntoView();
        document.getElementById("scrollToTop").scrollIntoView();
        // TODO: Can we add up, instead of removing previous? Then, add a delete button?

      } catch (err) {
        alert("Invalid GeoJSON:\n" + err.message);
      }
    };

    // Define event listener for change of process id, so I can switch off/ switch on
    // the buttons for examples (which only work for one-click examples)!
    var eventProcessChanged = function(evt){
      console.log("Process changed to: "+this.value);

      // Add name to info control
      infoControl._div.innerHTML =
          `process id: ${this.value}`;

      // Is this a process that needs one or two coordinate pairs?
      let pairs = evt.target.options[evt.target.selectedIndex].dataset.pairs;
      console.log("Process needs "+pairs+" coordinate pairs.");

      // Hide/unhide example buttons
      if (pairs == 'two') {
        defineTwoClickExampleButtons();
        var divsToHide = document.getElementsByClassName("fortwo");
        for(var i = 0; i < divsToHide.length; i++){
          divsToHide[i].classList.remove('invisible');
        }
      } else {
        defineOneClickExampleButtons();
        var divsToHide = document.getElementsByClassName("fortwo");
        for(var i = 0; i < divsToHide.length; i++){
          divsToHide[i].classList.add('invisible');
        }
      }

      // Hide/unhide strahler order
      // The value of the form is ...
      // get-snapped-points
      // get-snapped-point-plus
      // Note: When strahler is specified and >1, it will always show connecting line and ...
      // so the difference between with and without "-plus" is removed!
      console.log("[DEBUG] Value of min strahler: "+document.getElementById("strahlerSnap").value);
      if (this.value.startsWith("get-snapped-point")) {
        document.getElementById("strahlerSnap").classList.remove('invisible');
        console.log("[DEBUG] Show form to enter min strahler. Value: "+document.getElementById("strahlerSnap").value);
      } else {
        document.getElementById("strahlerSnap").classList.add('invisible');
        console.log("[DEBUG] Hide form to enter min strahler. Value: "+document.getElementById("strahlerSnap").value);
      }

      // Previously, we had to disable the example buttons once a two-pair process
      // was selected, as we had no two-pair examples - now we do.
      //
      // But in case we include processes where we need to disable again:
      //if (pairs == 'n') {
      //  // now, n clicks are needed and our examples don't work anymore:
      //  let exampleButtons = document.getElementsByClassName("oneclickexample");
      //  for (let i = 0; i < exampleButtons.length; i++) {
      //    exampleButtons[i].disabled = true;
      //  }
      //} else {
      // now, 1-2 clicks are needed and our examples will work:
      //  let exampleButtons = document.getElementsByClassName("oneclickexample");
      //  for (let i = 0; i < exampleButtons.length; i++) {
      //    exampleButtons[i].disabled = false;
      //  }
      //}
    }


    ///////////////////////////////
    //// Other functions ////
    ///////////////////////////////

    // Global variables needed for behaviour on map click:
    var thisIsSecondClick = false;
    var firstClickLon = null;
    var firstClickLat = null;


    // Define behaviour on map click (function)
    var mapClickBehaviour = function(evt) {
      let logUserAction = "clicked on map";

      // Get coordinates from click location:
      clicklon = evt.latlng.lng;
      clicklat = evt.latlng.lat;
      console.log('[mapclick] There was a click on the map: '+clicklon+', '+clicklat+' (lon, lat, WGS84)');

      // Get process id from dropdown menu:
      var dropdown = document.getElementById("processes");
      var processId = dropdown.value;
      var processDesc = dropdown.options[dropdown.selectedIndex].text;
      let pairs = dropdown.options[dropdown.selectedIndex].dataset.pairs;
      console.log('[mapclick] When clicked (on map), this process was selected: '+processId+' ('+processDesc+') ('+pairs+' pairs).');

      // Only click of one!
      if (pairs === "one") {

        // Write the coordinates into the coordinate fields:
        document.getElementById("customLonLat1").value=clicklon+", "+clicklat;
        document.getElementById("customLon1").value=clicklon;
        document.getElementById("customLat1").value=clicklat;

        // Update the URL field on top:
        // TODO: ALso add this for min_strahler!
        // TODO: ONE DAY: Also add this for two points, if I ever allow two points in URL params...
        const url = new URL(window.location);
        url.searchParams.set("lon", clicklon);
        url.searchParams.set("lat", clicklat);
        url.searchParams.set("processId", processId);
        history.replaceState({}, "", url);

	// Send the request:
        ogcRequestOneCoordinatePair(map, clicklon, clicklat, processId, processDesc, logUserAction);

      // If two clicks are expected, count the clicks and behave accordingly:
      } else {

        // First click of two!
        if (!thisIsSecondClick) {
          console.log('[mapclick] First click, expecting a second one.');
          // Make sure the next click is counted the second:
          thisIsSecondClick = true;

          // Add icon and popup to click location, telling user to click again
          clickMarker = putIconToClickLocation(clicklon, clicklat, map, logUserAction);
          clickMarker.bindPopup("You selected "+processDesc+", so please click another time!").openPopup();

          // Remember the coordinates of this first click, for the second:
          firstClickLat = clicklat;
          firstClickLon = clicklon;

          // Write the coordinates into the coordinate fields:
          document.getElementById("customLonLat1").value=clicklon+", "+clicklat;
          document.getElementById("customLon1").value=clicklon;
          document.getElementById("customLat1").value=clicklat;

          // Return to avoid triggering any request yet:
          return;

        // Second click of two:
        } else {
          console.log('[mapclick] Second click, the first one already occurred before.');

          // Write the coordinates into the coordinate fields:
          document.getElementById("customLonLat2").value=clicklon+", "+clicklat;
          document.getElementById("customLon2").value=clicklon;
          document.getElementById("customLat2").value=clicklat;

          // Make sure the next click is counted the first:
          thisIsSecondClick = false;
          ogcRequestTwoCoordinatePairs(map, firstClickLon, firstClickLat, clicklon, clicklat, processId, processDesc, logUserAction);
        }
      }
    };

    var urlParamBehaviour = function(lon, lat, processId, processDesc, pairs, logUserAction) {
      console.log('[urlparam] User passed URL parameters...');

      // Some URL params were passed.
      // Now checking whether the required values are there and formatted correctly:
      if (missing.length > 0) {
        console.warn("[urlparam] Missing parameters:", missing.join(', '));
      } else if (!Number.isFinite(lat) || !Number.isFinite(lon)) {
        console.warn("[urlparam] All required parameters present, but at least one coordinate is not a number: "+lon+", "+lat+" (lon, lat). Not doing anything.");
      } else {
        console.log("[urlparam] All required parameters present: "+lon+", "+lat+" (lon, lat), triggering process: "+processId);
        let logUserAction = "passed URL params";
        let pairs = "one"; // currently, we can only pass one pair of coords
        let processDesc = "process provided by user"
        // TODO Allow passing two pairs!
        // TODO Get the proper processDesc, e.g. Upstream catchment (individual polygons)
        ogcRequestOneCoordinatePair(map, lon, lat, processId, processDesc, logUserAction);

      }
    };


    // Define clearing the map
    var clearMap = function() {
      console.log("[DEBUG] Clearing the map.");
      for (var i = 0; i < allMyLayers.length; i++) {
        map.removeLayer(allMyLayers[i]);
      };
      for (var i = 0; i < allMyIcons.length; i++) {
        map.removeLayer(allMyIcons[i]);
      };
      document.getElementById("displayGeoJSON").innerHTML = "";
    }


    //////////////////////////////////////////
    //// Define buttons and add behaviour ////
    //////////////////////////////////////////

    // Run the button content/text definition:
    defineOneClickExampleButtons();

    // Bind custom-button behaviour to the custom-button click event:
    document.getElementById("clearMapButton").onclick = clearMap;
    document.getElementById("downloadGeojsonButton").onclick = downloadGeoJson;

    // Bind custom-button behaviour to the custom-button click event:
    document.getElementById("customLonlatButton").onclick = customButtonClickBehaviour;

    // Bind one-click or two-click to the event of process change:
    document.getElementById("processes").addEventListener('input', eventProcessChanged);

    // When a user modifies text fields "lon", "lat" or "lon,lat", modify the others accordinly:
    document.getElementById("customLonLat1").addEventListener('input', eventLonLat1Changed);
    document.getElementById("customLon1").addEventListener('input', eventLon1Changed);
    document.getElementById("customLat1").addEventListener('input', eventLatChanged);
    document.getElementById("customLonLat2").addEventListener('input', eventLonLat2Changed);
    document.getElementById("customLon2").addEventListener('input', eventLon2Changed);
    document.getElementById("customLat2").addEventListener('input', eventLat2Changed);
    // When a user modifies/focuses the subcatchment id field, remove the coordinates:
    document.getElementById("customSubc1").addEventListener('input', eventSubcid1Changed);
    document.getElementById("customSubc1").addEventListener('focus', eventSubcid1Changed);
    document.getElementById("customSubc2").addEventListener('input', eventSubcid2Changed);
    document.getElementById("customSubc2").addEventListener('focus', eventSubcid2Changed);
    // When a user focuses back on coordinates, remove the subcatchment fields:
    document.getElementById("customLonLat1").addEventListener('focus', eventCoord1Focus);
    document.getElementById("customLon1").addEventListener('focus', eventCoord1Focus);
    document.getElementById("customLat1").addEventListener('focus', eventCoord1Focus);
    document.getElementById("customLonLat2").addEventListener('focus', eventCoord2Focus);
    document.getElementById("customLon2").addEventListener('focus', eventCoord2Focus);
    document.getElementById("customLat2").addEventListener('focus', eventCoord2Focus);

    // When a user clicks the button to display custom GeoJSON
    document.getElementById('customGeoJsonButton').addEventListener('click', eventCustomGeojsonDisplay);

    // Bind map click behaviour to the map click event:
    map.on('click', mapClickBehaviour);

    // If URL params were passed, do not wait for user's click, but trigger the request already:
    const requiredParams = ['lon', 'lat', 'processId'];
    // console.log('[DEBUG] URL params that are present: '+params);
    const missing = requiredParams.filter(p => !params.has(p));
    if (missing.length == 3) {
      console.log('[urlparam] No useful URL parameters passed.')
      console.log('Waiting for user to click to get a coordinate...');
    } else {
      // If all URL params were passed, continue here...
      urlParamBehaviour(paramLon, paramLat, paramProcessId);
    }
    console.log('Waiting for user to click to get a coordinate...');

  </script>
</body>

</html>



